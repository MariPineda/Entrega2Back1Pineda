<h1>Productos en Tiempo Real</h1>

<form id="productForm">
    <input type="text" name="title" placeholder="Título" required />
    <input type="text" name="description" placeholder="Descripción" required />
    <input type="text" name="code" placeholder="Código" required />
    <input type="number" name="price" placeholder="Precio" required />
    <input type="number" name="stock" placeholder="Stock" required />
    <input type="text" name="category" placeholder="Categoría" required /> 
    <input type="text" name="thumbnails" placeholder="Thumbnails (opcional)" />
    <button type="submit">Agregar Producto</button>
</form> 

<!--<form id="deleteForm">
    <input type="text" name="id" id="deleteId" placeholder="ID del producto a eliminar" required />
    <button type="submit">Eliminar Producto</button>
</form>-->

<ul id="productsList"></ul>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();

    const productForm = document.getElementById('productForm'); 
    //const deleteForm = document.getElementById('deleteForm');
    const productList = document.getElementById('productsList');

    productForm.addEventListener('submit', e => {
        e.preventDefault();
        const formData = new FormData(productForm);
        const productData = Object.fromEntries(formData.entries());
        productData.price = parseFloat(productData.price);
        productData.stock = parseInt(productData.stock); 
        productData.thumbnails = [productData.thumbnails || ''];
        socket.emit('new-product', productData);
        productForm.reset();
    }); 

    //deleteForm.addEventListener('submit', e => {
      //  e.preventDefault();
       // const id = document.getElementById('deleteId').value.trim();
        //if (id) {
          //  socket.emit('delete-product', id);
            //deleteForm.reset();
        //}
    //});

    socket.on('update-products', products => { 
        console.log('⚡ Productos recibidos por socket:', products);
        productList.innerHTML = '';
        products.forEach(p => {
            const li = document.createElement('li');
            li.innerHTML = `
                <strong>${p.title || p.titulo}</strong> - ${p.description || p.descripcion} - $${p.price || p.precio}
                <button data-id="${p.id}">Eliminar</button>
            `;
            productList.appendChild(li);

           // Evento del botón
            const btn = li.querySelector('button');
            btn.addEventListener('click', () => {
                const id = btn.getAttribute('data-id');
                socket.emit('delete-product', id);
            });
        });
    });
</script>
